RewriteEngine On

# Redirect requests ending in .php to directory form (e.g., /foo.php -> /foo/)
RewriteCond %{REQUEST_URI} \.php$
RewriteRule ^(.*)\.php$ /$1/ [R=301,L]

# Append trailing slash if not a file and no slash
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_URI} !/$
RewriteRule ^(.*[^/])$ /$1/ [R=301,L]

# Internally rewrite /path/ to /path.php or /path/index.php if they exist
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{DOCUMENT_ROOT}/pic2map/$1.php -f
RewriteRule ^(.*)/$ /pic2map/$1.php [L]

RewriteCond %{DOCUMENT_ROOT}/pic2map/$1/index.php -f
RewriteRule ^(.*)/$ /pic2map/$1/index.php [L]

# If no matching script, show 404
RewriteRule ^(.*)/$ - [R=404,L]
